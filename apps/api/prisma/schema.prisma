generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

enum PuzzleMode {
  EASY
  HARD
}

enum BodyType {
  SEDAN
  HATCHBACK
  COUPE
  SUV
  WAGON
  CONVERTIBLE
  PICKUP
}

enum FuelType {
  PETROL
  DIESEL
  ELECTRIC
  HYBRID
}

enum Transmission {
  MANUAL
  AUTOMATIC
}

enum WikiLang {
  fr
  en
}

model CarModel {
  id                   Int          @id @default(autoincrement())
  make                 String
  model                String
  generation           String?
  bodyType             BodyType
  countryOfOrigin      String
  productionStartYear  Int
  productionEndYear    Int?
  wikiTitleFr          String?
  wikiTitleEn          String?
  wikiGenerationHintFr String?
  wikiGenerationHintEn String?

  variants             CarVariant[]
  puzzlesEasy          DailyPuzzle[] @relation("EasyTarget")

  @@index([make, model])
  @@index([countryOfOrigin])
  @@index([productionStartYear, productionEndYear])
}

model CarVariant {
  id                   Int          @id @default(autoincrement())
  modelId              Int
  fuelType             FuelType
  transmission         Transmission
  powerHp              Int?
  engineType           String?
  displacementCc       Int?
  maxSpeedKmh          Int?
  zeroToHundredSec     Float?
  productionStartYear  Int?
  productionEndYear    Int?

  model                CarModel      @relation(fields: [modelId], references: [id], onDelete: Cascade)
  puzzlesHard          DailyPuzzle[] @relation("HardTarget")

  @@index([modelId])
  @@index([fuelType, transmission])
  @@index([powerHp])
}

model DailyPuzzle {
  id              Int        @id @default(autoincrement())
  date            String
  mode            PuzzleMode
  targetModelId   Int?
  targetVariantId Int?

  targetModel     CarModel?   @relation("EasyTarget", fields: [targetModelId], references: [id], onDelete: Restrict)
  targetVariant   CarVariant? @relation("HardTarget", fields: [targetVariantId], references: [id], onDelete: Restrict)

  @@unique([date, mode])
  @@index([mode])
  @@index([targetModelId])
  @@index([targetVariantId])
}

model WikiSummaryCache {
  id        Int      @id @default(autoincrement())
  lang      WikiLang
  title     String
  extract   String
  url       String
  source    String
  fetchedAt DateTime
  expiresAt DateTime

  @@unique([lang, title])
  @@index([expiresAt])
}
